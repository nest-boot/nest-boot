---
sidebar_position: 11
---

# 国际化

`@nest-boot/i18n` 模块通过 [i18next](https://www.i18next.com/) 提供国际化（i18n）支持，支持基于文件系统的翻译加载和自动 HTTP 语言检测。

## 安装

```bash
npm install @nest-boot/i18n i18next i18next-fs-backend i18next-http-middleware
# 或
pnpm add @nest-boot/i18n i18next i18next-fs-backend i18next-http-middleware
```

## 基本用法

### 模块注册

在应用模块中注册 `I18nModule`：

```typescript
import { Module } from "@nestjs/common";
import { I18nModule } from "@nest-boot/i18n";

@Module({
  imports: [
    I18nModule.register({
      fallbackLng: "en",
      supportedLngs: ["en", "zh"],
    }),
  ],
})
export class AppModule {}
```

### 异步注册

```typescript
import { Module } from "@nestjs/common";
import { ConfigModule, ConfigService } from "@nestjs/config";
import { I18nModule } from "@nest-boot/i18n";

@Module({
  imports: [
    ConfigModule.forRoot(),
    I18nModule.registerAsync({
      inject: [ConfigService],
      useFactory: (config: ConfigService) => ({
        fallbackLng: config.get("DEFAULT_LANGUAGE", "en"),
      }),
    }),
  ],
})
export class AppModule {}
```

## 翻译文件

默认情况下，翻译文件从项目根目录的 `locales` 目录加载：

```
project/
├── locales/
│   ├── en/
│   │   └── translation.json
│   └── zh/
│       └── translation.json
└── src/
```

翻译文件示例（`locales/en/translation.json`）：

```json
{
  "welcome": "Welcome, {{name}}!",
  "errors.notFound": "Resource not found",
  "errors.unauthorized": "You are not authorized"
}
```

## 使用翻译

### 使用 t() 辅助函数

在服务中使用 `t()` 工具函数进行翻译：

```typescript
import { Injectable } from "@nestjs/common";
import { t } from "@nest-boot/i18n";

@Injectable()
export class GreetingService {
  getWelcomeMessage(name: string): string {
    return t("welcome", { name });
  }

  getErrorMessage(): string {
    return t("errors.notFound");
  }
}
```

### 使用 @I18n() 装饰器

使用 `@I18n()` 装饰器直接注入 i18n 实例：

```typescript
import { Controller, Get } from "@nestjs/common";
import { I18n as I18nDecorator } from "@nest-boot/i18n";
import { i18n } from "i18next";

@Controller("greetings")
export class GreetingController {
  @Get()
  getGreeting(@I18nDecorator() i18n: i18n) {
    return { message: i18n.t("welcome", { name: "World" }) };
  }
}
```

## 配置选项

支持所有 [i18next 选项](https://www.i18next.com/overview/configuration-options)，包括：

| 选项            | 类型       | 描述                                |
| --------------- | ---------- | ----------------------------------- |
| `fallbackLng`   | `string`   | 翻译缺失时的回退语言（默认：`en`）  |
| `supportedLngs` | `string[]` | 支持的语言列表                      |
| `ns`            | `string[]` | 要加载的命名空间                    |
| `defaultNS`     | `string`   | 默认命名空间（默认：`translation`） |
| `keySeparator`  | `string`   | 嵌套键的分隔符（默认：禁用）        |

## 默认配置

模块提供以下默认值：

- **后端**：文件系统后端，从 `locales/{{lng}}/{{ns}}.json` 加载
- **语言检测**：通过 HTTP 头（`Accept-Language`）自动检测
- **回退语言**：`en`
- **键分隔符**：禁用（扁平键结构）
- **转义值**：禁用（用于安全的 HTML 渲染）

## API 参考

查看完整的 [API 文档](/docs/api/@nest-boot/i18n) 获取详细信息。

## 特性

- **i18next 集成** - 通过 NestJS 依赖注入使用完整的 i18next API
- **文件系统后端** - 从 JSON 翻译文件自动加载
- **HTTP 语言检测** - 从请求头自动检测语言
- **请求作用域** - 通过请求上下文实现每请求语言
- **装饰器支持** - 控制器中使用 `@I18n()` 参数装饰器
- **辅助函数** - `t()` 工具函数用于快速翻译
